version: '3.8'
services:
  # The compose setup can run the app container but will connect to an external
  # PostgreSQL (Neon) instance instead of a local DB. This file expects secrets
  # to be provided via an environment file or host environment variables.
  app:
    build: .
    ports:
      - "8081:8080"  # map host 8081 -> container 8080
    environment:
      # Provide full JDBC URL via NEON_DATABASE_URL or SPRING_DATASOURCE_URL env var
      SPRING_DATASOURCE_URL: ${NEON_DATABASE_URL}
      SPRING_DATASOURCE_USERNAME: ${NEON_DATABASE_USERNAME}
      SPRING_DATASOURCE_PASSWORD: ${NEON_DATABASE_PASSWORD}
      SPRING_DATASOURCE_DRIVER: org.postgresql.Driver
      # Optional: disable Flyway in container if you prefer to run migrations externally
      # Default is false to avoid accidental automatic schema changes on startup.
      SPRING_FLYWAY_ENABLED: ${SPRING_FLYWAY_ENABLED:false}
      # JWT secret should also be provided via environment for production
      JWT_SECRET: ${JWT_SECRET}
    restart: on-failure

# No local DB volume in this compose â€” we rely on the external Neon DB.
